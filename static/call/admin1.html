<!DOCTYPE html>
<html lang='en'>
	<head>
		<meta charset="utf-8">
    	<title>Bakbak io</title>
    	<meta name="viewport" content="width=device-width, initial-scale=1.0">
    	<meta name="description" content="">
    	<meta name="author" content="">
		<script src='https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js'></script>
		<script src="http://ajax.microsoft.com/ajax/jquery.templates/beta1/jquery.tmpl.min.js"></script>
		<script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.8.16/jquery-ui.js"></script>
		<script src="http://getbootstrap.com/2.3.2/assets/js/bootstrap-tooltip.js"></script>
		<script src="http://getbootstrap.com/2.3.2/assets/js/bootstrap-popover.js"></script>
		<script src="https://maps.googleapis.com/maps/api/js?v=3.exp&sensor=true"></script>
		<script src="/socket.io/socket.io.js"></script>
		<script src="/js/app/call.js"></script>
		<script src="/js/app/utils.js"></script>
		<script src="/js/app/customer.js"></script>
		<script type="text/javascript">
			var customer = new Customer('admin');
			customer.init();
		</script>
		<script id="UserListTemplate" type="text/x-jquery-tmpl">
			<tr id='${visitorId}'>
				<div id='userEntry' class='userListing'>
					<td>
						<div class='userId'><p class="text-success" >${visitorId}</p></div>
						<div class='userName'><p class="text-success" onClick=customer.editUserId('${visitorId}',this,'${id}')> ${visitorName}</p></div>
					</td>
					<td>
						<div class='webRtcSupport alert'>
						{{if webrtc.support}}
							{{if webrtc.webAudio}}
								<img class='imageIconMedium' src='/img/actions/png/audio.png' title='Call' onClick=customer.audioCall('${id}')></img>
							{{else}}
								<img class='imageIconMedium' src='/img/actions/png/dnd.png' title='No Call'></img>
							{{/if}}
							{{if webrtc.mediaStream }}
								<img class='imageIconMedium' src='/img/actions/png/video.png' title='Video'></img>
							{{else}}
								<img class='imageIconMedium' src='/img/actions/png/dnd.png' title='No Video'></img>
							{{/if}}
							{{if webrtc.screenSharing }}
								<img class='imageIconMedium' src='/img/actions/png/screen.png' title='Screen'></img>
							{{else}}
								<img class='imageIconMedium' src='/img/actions/png/dnd.png' title='No Screen'></img>
							{{/if}}
						{{else}}
							<img class='imageIconMedium' src='/img/actions/png/dnd.png' title='No WebRTC'></img>
						{{/if}}
							<img class='imageIconMedium' src='/img/actions/png/email.png' title='Email' onClick = customer.emailVisitorDetails('${visitorId}')></img>
						</div>
					</td>
					<td>
						<div class='googleAnalytics'>
							<table class='table table-striped'>
							<tr>
							<p class='alert'>Analytics</p>
							</tr>
							{{if gAData.__utmcmd != null }}
								<tr>
									<td>Medium:</td><td>${gAData.__utmcmd}</td>
								</tr>
							{{/if}}
							{{if gAData.__utmcsr != null }}
								<tr>
									<td>Source:</td><td>${gAData.__utmcsr}</td>
								</tr>
							{{/if}}
							{{if gAData.__utmcct != null }}
								<tr>
									<td>Content:</td><td>${gAData.__utmcct}</td>
								</tr>
							{{/if}}
							{{if gAData.__utmccn != null }}
								<tr>
									<td>Campaing:</td><td>${gAData.__utmccn}</td>
								</tr>
							{{/if}}
							{{if gAData.__utmctr != null }}
								<tr>
									<td>Keyword:</td><td>${gAData.__utmctr}</td>
								</tr>
							{{/if}}
							{{if gAData.__utmclid != null }}
								<tr>
									<td>Adword:</td><td>${gAData.__utmclid}</td>
								</tr>
							{{/if}}
							{{if gAData.__utma != null }}
								<tr>
								</tr>
									<td>Initial Visit:</td><td>${(new Date(gAData.__utma.split('.')[2])).toTimeString()}</td>
								<tr>
									<td>Previous Visit:</td><td>${(new Date(gAData.__utma.split('.')[3])).toTimeString()}</td>
								</tr>
								<tr>
									<td>Session Begin:</td><td>${(new Date(gAData.__utma.split('.')[4])).toTimeString()}</td>
								</tr>
							{{/if}}
							{{if gAData.__utmb != null }}
								<tr>
									<td>Total Visits:</td><td>${gAData.__utmb.split('.')[1]}</td>
								</tr>
							{{/if}}
							{{if gAData.__utmv != null }}
								<tr>
									<td>Custom Variable:</td><td>${gAData.__utmv}</td>
								</tr>
							{{/if}}
							{{if referer != null }}
								<tr>
									<td>Known</td><td>${referer.known}</td>
								</tr>
								<tr>
									<td>Referer</td><td>${referer.referer}</td>
								</tr>
								<tr>
									<td>Medium</td><td>${referer.medium}</td>
								</tr>
								<tr>
									<td>Search Term</td><td>${referer.search_term}</td>
								</tr>
								<tr>
									<td>Uri</td><td>${referer.uri.href}</td>
								</tr>
								<tr>
									<td>Current</td><td id='curent_url${visitorId}'>${current_url}</td>
								</tr>
							{{/if}}
							</table>
						</div>
					</td>
					<td>
					{{if location}}
					
								<div class='locationDetails alert'>
									<img id='flagIcon${visitorId}' src='/img/flags/png/${location.geoplugin_countryCode.toLowerCase()}.png' data-toggle='tooltip' data-trigger='hover click' data-title='${location.geoplugin_countryName}' class='flagIcon'/> 
									<a href='#' id='map${visitorId}' data-trigger='click' titel='${location.geoplugin_city}' data-html='true'>${location.geoplugin_city}</a>
									 [${location.geoplugin_currencySymbol} ${location.geoplugin_currencyConverter} = $1]
								<div>
					{{else}}
						<div class='locationDetails alert'>Location fetching...</div>
					{{/if}}
					</td>
					<td>
						<div class='browserDetails alert'><img class='imageIconMedium' src='/img/browsers/png/${ua.ua.family.toLowerCase().replaceAll(" ","_")}.png' title='${ua.ua.family}'/> ${ua.ua.major}.${ua.ua.minor}
						<img class='imageIconMedium' src='/img/os/png/${ua.os.family.toLowerCase().replaceAll(" ","_")}.png' title='${ua.os.family}'> ${ua.os.major}.${ua.os.minor}</img>
						 ${ua.device.family}</div>
					</td>
					<td> {{if visitorId}}
						<div class='chatPanel'>
									<div id='chatMsgBox${visitorId}' class='chatMessages maxHeight100 scrollbar backgroundWhite'></div>
									<div id='chatSendBox${visitorId}'class='chatText input-append'>
  										<input id='chatMsg${visitorId}' class="input-block-level" id="chatMsg${visitorId}" type="text" placeholder="Chat" onkeydown="if (event.keyCode == 13) customer.sendChatMessage('${id}','${visitorId}',$('#chatMsg${visitorId}').val());">
  										<button id='chatSendButton${visitorId}' class="btn btn-success" type="button" onClick='customer.sendChatMessage("${id}",'${visitorId}',$("#chatMsg${visitorId}").val());'>Chat</button>
									</div>
						</div>
						{{else}}
						<div class='chatPanel'> Intializing...</div>
						{{/if}}
					</td>
				</tr>
			</div>
		</script>
		<link href="http://getbootstrap.com/2.3.2/assets/css/bootstrap.css" rel="stylesheet">
		<link href="http://getbootstrap.com/2.3.2/assets/css/bootstrap-responsive.css" rel="stylesheet">
		<link href="/css/base.css" rel="stylesheet">
		<!-- HTML5 shim, for IE6-8 support of HTML5 elements -->
    	<!--[if lt IE 9]>
      		<script src="http://getbootstrap.com/2.3.2/assets/js/html5shiv.js"></script>
    	<![endif]-->
    	<!-- Fav and touch icons -->
    	<link rel="apple-touch-icon-precomposed" sizes="144x144" href="http://getbootstrap.com/2.3.2/assets/ico/apple-touch-icon-144-precomposed.png">
    	<link rel="apple-touch-icon-precomposed" sizes="114x114" href="http://getbootstrap.com/2.3.2/assets/ico/apple-touch-icon-114-precomposed.png">
      	<link rel="apple-touch-icon-precomposed" sizes="72x72" href="http://getbootstrap.com/2.3.2/assets/ico/apple-touch-icon-72-precomposed.png">
        <link rel="apple-touch-icon-precomposed" href="http://getbootstrap.com/2.3.2/assets/ico/apple-touch-icon-57-precomposed.png">
        <link rel="shortcut icon" href="http://getbootstrap.com/2.3.2/assets/ico/favicon.png">
	</head>
	<body>
		<div id='currentOnlineUsers'>
			<p>Logged in users.</p>
			<table id='userList' class='table table-striped table-hover table-bordered'></div>
		</div>
	</body>
</html>
